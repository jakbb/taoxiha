package com.taoxiha.common.utils.log;import java.io.File;import java.util.HashMap;import java.util.Map;import org.apache.log4j.Appender;import org.apache.log4j.Layout;import org.apache.log4j.Logger;import org.apache.log4j.MDC;import org.apache.log4j.PatternLayout;import org.apache.log4j.RollingFileAppender;import org.apache.log4j.spi.LoggingEvent;import com.taoxiha.common.utils.date.DateUtils;import com.taoxiha.common.utils.io.FileHelper;import com.taoxiha.service.crawl.entity.CrawlInfoConfig;public class CrawlLogUtils {		private static final Logger CRAWL_DATA_LOG =Logger.getLogger("crawl_data_log");			     public static Logger saveLog(String fileName){	    	 final Logger log =CRAWL_DATA_LOG;	    	 final CrawlAppenderFactory factory= new CrawlAppenderFactory();	    	  Appender appender = factory.getAppender(fileName);	          if (!log.isAttached(appender)) {	            log.addAppender(appender);	          }	    	 return log;	     }	}	class CrawlAppenderFactory {	static Map<String, Appender> appenders = new HashMap<String, Appender>();	  public Appender getAppender(String tasknum) {	    Appender appender = appenders.get(tasknum);	    if (appender == null) {	      appender = new CrawlAppender(tasknum);	      appenders.put(tasknum, appender);	    }	    return appender;	  }	}	class CrawlAppender extends RollingFileAppender {		private final String filename;	public CrawlAppender(String fileName) {		this.filename=fileName;		MDC.put("filename", filename);  	    Layout layout = new PatternLayout("%m%n"); 		String datadir=CrawlInfoConfig.datapath+"/"+DateUtils.getTheDateString();		File file= new File(datadir,fileName);		if(!file.isFile()){			file=FileHelper.mkdir(datadir,fileName);		}      setLayout(layout);      setFile(file.getAbsolutePath());	   activateOptions(); //打开一次文件	  }	  @Override	  public synchronized void doAppend(LoggingEvent event) {	    String filename = (String) MDC.get("filename");	    if (this.filename.equals(filename)) {	      // 一个Appender对应一个tasknum，其他tasknum的event直接忽略	    	super.doAppend(event);	    }	  }	}